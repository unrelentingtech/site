+++
date = 2016-07-17T15:14:33+00:00
path = "/replies/2016-07-17-15-14-33"

[extra]
client_id = ["https://woodwind.xyz/"]

[[extra.in_reply_to]]
author = "https://aaronparecki.com/"
name = "Where was I when I took this photo?"
published = 2016-07-17T03:59:55+00:00
type = "entry"
url = "https://aaronparecki.com/2016/07/16/8/geotagging-photos"

[extra.in_reply_to.content]
text = "My DSLR camera doesn't have GPS, so normally all my photos would not include the location of where I was when I took the photo. I used to use the Eye-Fi card that did geotagging, but that is no longer supported in the new \"mobi\" line. I could get an external GPS unit for my camera, but that sounds cumbersome and would only work with that one camera.\n\nSince I already track everywhere I go, I figured I could use this data to geotag my photos when I upload them to Flickr. It turns out, due to the limitations of Exif, the metadata format that digital cameras use to store information about photos, it wasn't so easy.\n\nAdventures in Exif\nExif lets the camera write arbitrary text data into a jpg when it saves it. There are a handful of standard properties that most cameras write, such as the time the photo was taken, the camera settings such as shutter speed, f-stop, etc, and GPS location if the camera knows where it is. My thought was that if I know when the photo was taken, I can find out where I was at that time, and then add the GPS data to the photo.\n\nUnfortunately, the format for storing dates in Exif does not support specifying a timezone offset. The format for dates is YYYY:MM:DD HH:MM:SS. Without the timezone offset, this series of numbers corresponds to many different actual points in time, depending on which timezone you interpret it as. So what I need is a way to turn the camera time into a specific point in time in order to find out where I was at that time.\n\nA + B = CI realized that since I have a complete log of my GPS coordinates, I should have enough information to piece this together. Essentially the question I am asking is \"where was I when my clock read 7:00pm on July 16 2016?\" Note that there are two parts to the answer: my location, and the absolute point in time. It's kind of like solving an equation where there are three variables and you know two of them. The three variables are: my location, the clock time, and the timezone offset. If we knew my location and the clock time, we could find the timezone offset. If we knew the timezone offset and the clock time, then we could find my location.\n\nWhere was I when my clock read \"7:00pm on July 16 2016\"?\n\nIf we knew what timezone I was in, then \"7:00pm on July 16, 2016\" becomes a single reference to an absolute point in time. But we don't know what timezone I was in yet, so there are actually 24 possible absolute points in time this could be. (I'm simplifying this problem slightly by ignoring the 30-minute offset timezones.)\n\nThe solution is to find my location (which includes the absolute point in time) at all 24 possible points in time, find the timezone offset that corresponds to each location, then find the location where its timezone offset matches the candidate offset. Below is an example:\n\nOffset-less time in question: 2016-05-12 16:00:00\n\nThis could be any of the absolute points in time:\n\n2016-05-12 16:00:00 -23:002016-05-12 16:00:00 -22:00...2016-05-12 16:00:00 -07:002016-05-12 16:00:00 -08:002016-05-12 16:00:00 -06:002016-05-12 16:00:00 -05:002016-05-12 16:00:00 -04:002016-05-12 16:00:00 -03:00...2016-05-12 16:00:00 +00:002016-05-12 16:00:00 +01:002016-05-12 16:00:00 +02:00...2016-05-12 16:00:00 +22:002016-05-12 16:00:00 +23:00\n\n(I left out some of the less common timezone offsets I frequent for the sake of clarity in this example.) Now let's query my GPS database to find out what my local time actually was at each of these points in time:\n\nPotential Time\n    Time from GPS\n    Location\n  2016-05-12 16:00:00 -23:00\n    2016-05-13 10:59:03 -04:00\n    New York\n  2016-05-12 16:00:00 -22:00\n    2016-05-13 10:00:00 -04:00\n    New York\n  ...\n  2016-05-12 16:00:00 -07:00\n    2016-05-12 19:00:00 -04:00\n    New York\n  2016-05-12 16:00:00 -08:00\n    no data\n  2016-05-12 16:00:00 -06:00\n    2016-05-12 17:59:21 -04:00\n    New York\n  2016-05-12 16:00:00 -05:00\n    2016-05-12 16:59:53 -04:00\n    New York\n  2016-05-12 16:00:00 -04:00\n    2016-05-12 15:59:57 -04:00\n    New York\n  2016-05-12 16:00:00 -03:00\n    2016-05-12 14:52:46 +02:00\n    France\n  ...\n  2016-05-12 16:00:00 +00:00\n    2016-05-12 14:52:46 +02:00\n    France\n  2016-05-12 16:00:00 +01:00\n    2016-05-12 14:52:46 +02:00\n    France\n  2016-05-12 16:00:00 +02:00\n    2016-05-12 14:52:46 +02:00\n    France\n  ...\n  2016-05-12 16:00:00 +22:00\n    2016-05-11 19:15:41 +02:00\n    Düsseldorf\n  2016-05-12 16:00:00 +23:00\n    2016-05-11 18:46:26 +02:00\n    Düsseldorf\n\n\n(Note that the times aren't an exact match, because my GPS device doesn't log a point every second. In reality it's more like every second when I'm moving and have a good GPS lock, and when I'm not moving, it records less data. Also on plane flights I sometimes lose the GPS signal part way through the flight which is why many of the rows in this case show the same time from my GPS.)\n\nAs you can see by comparing the potential timezone on the left with the actual timezone on the right, there are two offsets that match (highlighted in yellow), so we need to determine which is the correct one. This happens when I am traveling on a plane and cross timezones very quickly.\n\nIf we take the two candidates and look at the actual time difference in seconds between the timestamps described, the answer becomes obvious.\n\nPotential Time\n    Time from GPS\n    Difference\n  2016-05-12 16:00:00 -04:00\n        unixtime: 1463083200\n    2016-05-12 15:59:57 -04:00\n        unixtime: 1463083197\n    3\n  2016-05-12 16:00:00 +02:00\n        unixtime: 1463061600\n    2016-05-12 14:52:46 +02:00\n        unixtime: 1463057566\n    4034\n\n\nFrom this, I can conclude that when my clock read \"2016-05-12 16:00:00\" it was at \"2016-05-12 16:00:00 -0400\" when I was in New York.\n\nMost of the time only one offset matches, so this last step isn't necessary. It's only when I quickly cross timezones that there are potentially more than one match.\n\nTurning this into an API\n\nSince I want to be able to use this to geotag photos, it makes sense to include it as an API in the same system that stores my GPS logs. I encapsulated this logic in my GPS server, Compass with a simple API that returns the answer given an offset-less time. Now I can use it in my geotagging script!"

+++

<p>Lightroom can import .gpx logs to automatically tag photos. But looks like you’re not someone who would use Lightroom :)</p>
<p>About the timezone problem — do you change the time on your camera when you travel to a different timezone? Why? Why not just let the camera’s clock stay in home time or UTC?</p>